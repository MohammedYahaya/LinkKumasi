<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Product â€¢ AgriLink</title>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2b7a0b">

</head>
<body>
  <header class="nav">
    <div class="container row">
      <a class="brand" href="index.html">ðŸŒ¿ AgriLink</a>
    </div>
  </header>

  <main class="container grid cols-2">
    <div class="card" id="left">
      <img id="pimg" src="" alt="" style="width:100%;height:260px;object-fit:cover;border-radius:10px;border:1px solid #eef2f3">
      <h2 id="ptitle"></h2>
      <div id="pcat" class="chip"></div>
      <p id="pdesc" class="muted"></p>
      <div class="kpi">
        <div class="chip">Kumasi</div>
        <div class="chip"><strong>GHS <span id="pprice"></span></strong></div>
        <div class="chip" id="trust">Trust --%</div>
      </div>
    </div>

    <aside class="card">
      <h3 data-i18n="suggestedBand">Suggested price band</h3>
      <div id="band" class="badge small">GHS --</div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f3" />

      <h3 data-i18n="chatFarmer">Negotiation assistant</h3>
      <div>
        <label>Enter your offer (GHS)</label>
        <input id="offer" type="number" value="30" />
      </div>
      <div style="margin-top:10px">
        <button class="btn" id="suggestBtn" data-i18n="counterOffer">Suggest counteroffer</button>
      </div>
      <div id="counterOut" style="margin-top:12px"></div>
    </aside>
  </main>

  <div id="toast" class="toast"></div>

  <script src="assets/js/lang.js"></script>
  <script src="assets/js/algorithms.js"></script>
  <script>
    // small client copy of demo listings (or fetch from api later)
    const listings = [
      { id:1, title:'Fresh Tomatoes (crate)', category:'Vegetables', description:'Red and juicy, local variety', price:32, lat:6.70, lng:-1.63, createdAt:'2025-08-12', tags:['fresh'], farmerStats:{confirmed:40,delivered:37,onTime:33,canceled:3,avgRating:4.4,ratingCount:28,kycVerified:true}, window:{from:'2025-08-11',to:'2025-08-26'}, photo:'https://picsum.photos/seed/tom/900/600' },
      { id:2, title:'Organic Yam (bag)', category:'Roots', description:'PÉ”nwuma from Ejisu â€” grade A', price:50, lat:6.68, lng:-1.59, createdAt:'2025-08-07', tags:['organic'], farmerStats:{confirmed:20,delivered:18,onTime:16,canceled:2,avgRating:4.2,ratingCount:12,kycVerified:false}, window:{from:'2025-08-09',to:'2025-08-30'}, photo:'https://picsum.photos/seed/yam/900/600' }
    ];

    function showToast(msg){ const el=document.getElementById('toast'); el.textContent=msg; el.style.display='block'; setTimeout(()=>el.style.display='none',1600); }

    // load product by id
    const params = new URLSearchParams(location.search);
    const id = Number(params.get('id')||1);
    const item = listings.find(l => l.id === id) || listings[0];
    document.getElementById('pimg').src = item.photo;
    document.getElementById('ptitle').textContent = item.title;
    document.getElementById('pcat').textContent = item.category;
    document.getElementById('pdesc').textContent = item.description;
    document.getElementById('pprice').textContent = item.price;
    document.getElementById('trust').textContent = Math.round(AgriAlgo.farmerReliability(item.farmerStats)*100) + '% trust';

    // price band hint
    const band = AgriAlgo.suggestPriceBand({median:30,q1:26,q3:36,demandIndex:1.03}, item);
    document.getElementById('band').textContent = `GHS ${band.min} â€“ ${band.max}`;

    document.getElementById('suggestBtn').addEventListener('click', () => {
      const offer = Number(document.getElementById('offer').value || 0);
      const counter = AgriAlgo.counterOffer(offer, item.price, band, { listingCreated: item.createdAt, stockLeft:8, initialStock:12 });
      document.getElementById('counterOut').innerHTML = `<div class="card">Suggested counter: <strong>GHS ${counter}</strong></div>`;
      showToast('Counter suggested');
    });
  </script>
</body>
</html>
